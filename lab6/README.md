# Лабораторная работа №6: Управление проектами

## Описание

Данный проект реализует систему управления проектами с использованием паттернов CQRS и "сквозное чтение". Сервис поддерживает аутентификацию через JWT-токены и выполняет CRUD-операции для пользователей, проектов и задач.

### Основные возможности:
1. **CQRS**:
   - Метод `POST` публикует сообщения о создании сущности в очередь **Kafka**.
   - Kafka consumer запускается в отдельном контейнере и автоматически записывает данные в PostgreSQL после получения события из очереди.
2. **Сквозное чтение (Redis)**:
   - Данные одной из сущностей кэшируются в **Redis** для повышения производительности.
3. **Аутентификация**:
   - Используется JWT-токен для защиты эндпоинтов.
4. **Базы данных**:
   - Пользователи и проекты хранятся в **PostgreSQL**.
   - Одна из сущностей хранится в **MongoDB**.

---

## Технологии

- **Язык**: Python 3.10
- **Фреймворк**: FastAPI
- **Базы данных**: PostgreSQL, MongoDB, Redis
- **Очереди сообщений**: Kafka
- **Контейнеризация**: Docker, Docker Compose

---

## Запуск проекта

### 1. Клонирование репозитория:
```
bash
git clone https://github.com/chaous/systemdesignlab1.git
cd systemdesignlab1/lab6
```

### 2. Запуск контейнеров:
```
bash
docker-compose down --volumes
docker-compose up --build
```

### 3. Тестовые данные:
- При первом запуске базы данных автоматически инициализируются тестовыми данными.
- Для проверки работоспособности проекта можно использовать `curl` или Postman.

---

## Основные эндпоинты API

### Пользователи:
1. **Создать пользователя**:
```
http
POST /users/
```
**Пример запроса**:
```
json
{
    "username": "testuser",
    "email": "testuser@example.com"
}
```

2. **Получить список пользователей**:
```
http
GET /users/
```

3. **Поиск пользователя по логину**:
```
http
GET /users/{username}
```

### Проекты:
1. **Создать проект**:
```
http
POST /projects/
```
**Пример запроса**:
```
json
{
    "name": "Test Project",
    "description": "This is a test project"
}
```

2. **Получить список проектов**:
```
http
GET /projects/
```

3. **Поиск проекта по названию**:
```
http
GET /projects/{name}
```

### Задачи:
1. **Создать задачу в проекте**:
```
http
POST /tasks/
```
**Пример запроса**:
```
json
{
    "project_id": 1,
    "title": "Test Task",
    "description": "This is a test task"
}
```

2. **Получить список задач в проекте**:
```
http
GET /tasks/?project_id={project_id}
```

---

## CQRS и Kafka

### Публикация сообщений:
- Метод `POST /tasks/` публикует сообщение о создании задачи в очередь **Kafka**.
- Сообщение содержит информацию о задаче (название, описание, проект).

### Обработка сообщений:
- Kafka consumer запускается в отдельном контейнере и обрабатывает сообщения, записывая задачи в базу данных **PostgreSQL**.

---

## Кэширование с помощью Redis

- Данные о проектах кэшируются в **Redis**.
- Если данные не найдены в кэше, они извлекаются из **PostgreSQL**, сохраняются в **Redis**, и затем возвращаются пользователю.
- Проверить содержимое кэша можно с помощью команды:
```
bash
docker exec -it redis redis-cli
GET project:{project_id}
```

---

## MongoDB

- Данные о задачах хранятся в **MongoDB**.
- Примеры запросов:
  - **Создание документа**:
```
http
POST /mongo/
```
```
json
{
    "key": "value"
}
```
  - **Получение всех документов**:
```
http
GET /mongo/
```

---

## Swagger UI

- Документация API доступна по адресу: `http://localhost:8000/docs`.

---

## Требования

- Docker версии 20.10+.
- Docker Compose версии 1.29+.
- Python 3.10+ для локального тестирования (опционально).

---

## Тестирование

- После запуска контейнеров API доступен по адресу: `http://localhost:8000`.
- Используйте инструменты вроде Postman или curl для отправки запросов к API.

---

## Авторы

- Репозиторий: [GitHub](https://github.com/chaous/systemdesignlab1/tree/main/lab6)
- Автор: Илья Рожков
