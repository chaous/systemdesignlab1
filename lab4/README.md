# Лабораторная работа №4

Данная лабораторная работа представляет собой веб-приложение, разработанное с использованием FastAPI, PostgreSQL и MongoDB. Приложение поддерживает работу с JWT-аутентификацией, хранит данные в реляционной базе данных PostgreSQL и не-реляционной базе данных MongoDB, а также предоставляет CRUD (создание, чтение, обновление, удаление) API для управления пользователями, товарами и заказами. В MongoDB хранится информация о заказах с индексом по `item_id` для оптимизации поиска.

## Основные функции приложения

1. **Регистрация и аутентификация пользователей**: Пользователь может создать аккаунт с логином и паролем, который будет сохранен в PostgreSQL. Для входа пользователь отправляет запрос на `/token`, получая JWT-токен, который затем используется для аутентификации в других запросах.
2. **Работа с товарами**: CRUD-операции для товаров: создание, просмотр, обновление и удаление.
3. **Работа с заказами**: Заказы создаются с привязкой к товарам и пользователю и хранятся в MongoDB. Доступны операции создания и просмотра заказов с индексом для ускорения поиска.

## Запуск приложения

1. Клонируйте репозиторий и перейдите в директорию проекта:
   ```bash
   git clone https://github.com/chaous/systemdesignlab1.git && cd systemdesignlab1/lab4
   ```

2. Убедитесь, что Docker и Docker Compose установлены на вашем компьютере.

3. Запустите приложение с помощью Docker Compose:
   ```bash
   docker-compose up --build
   ```

   Это команда создаст и запустит три контейнера:
   - **app**: контейнер с приложением на FastAPI.
   - **db**: контейнер с PostgreSQL для хранения данных пользователей и товаров.
   - **mongodb**: контейнер с MongoDB для хранения заказов.

4. Приложение будет доступно по адресу `http://localhost:8000`. Откройте его, чтобы взаимодействовать с API.

5. Для документации API перейдите по адресу `http://localhost:8000/docs`.

## Структура проекта

- `main.py`: основной файл приложения FastAPI. Включает:
  - **Маршруты для управления пользователями**: регистрация, вход (получение токена), поиск по логину.
  - **Маршруты для работы с товарами**: создание, получение, обновление и удаление.
  - **Маршруты для работы с заказами**: создание заказа и получение списка заказов пользователя.
- `Dockerfile`: инструкция для создания Docker-образа приложения.
- `docker-compose.yml`: файл для управления контейнерами приложения, PostgreSQL и MongoDB.
- `requirements.txt`: зависимости Python, используемые в приложении.

## Описание основных маршрутов API

### Управление пользователями

1. **Регистрация нового пользователя**  
   POST `/register`
   - **Параметры**: `username` (строка), `password` (строка)
   - **Описание**: Создает нового пользователя и сохраняет его в PostgreSQL.

2. **Получение JWT токена**  
   POST `/token`
   - **Параметры**: `username` (строка), `password` (строка)
   - **Описание**: Аутентификация пользователя и получение JWT-токена для доступа к защищенным маршрутам.

3. **Поиск пользователя по логину**  
   GET `/users/{username}`
   - **Параметры**: `username` (строка)
   - **Описание**: Возвращает информацию о пользователе по его логину.

### Управление товарами

1. **Создание нового товара**  
   POST `/items/`
   - **Параметры**: `name` (строка), `description` (строка), `price` (число)
   - **Описание**: Создает новый товар в PostgreSQL.

2. **Получение информации о товаре**  
   GET `/items/{item_id}`
   - **Параметры**: `item_id` (int)
   - **Описание**: Возвращает информацию о товаре по его ID.

3. **Обновление товара**  
   PUT `/items/{item_id}`
   - **Параметры**: `item_id` (int), `name` (строка), `description` (строка), `price` (число)
   - **Описание**: Обновляет информацию о товаре в PostgreSQL.

4. **Удаление товара**  
   DELETE `/items/{item_id}`
   - **Параметры**: `item_id` (int)
   - **Описание**: Удаляет товар из базы данных.

### Управление заказами

1. **Создание нового заказа**  
   POST `/orders/`
   - **Параметры**: `user_id` (int), `item_id` (int)
   - **Описание**: Создает новый заказ и сохраняет его в MongoDB.

2. **Получение заказов пользователя**  
   GET `/orders/{user_id}`
   - **Параметры**: `user_id` (int)
   - **Описание**: Возвращает список всех заказов пользователя из MongoDB.

## Конфигурация базы данных

При первом запуске Docker Compose создает и инициализирует базы данных PostgreSQL и MongoDB. В `docker-compose.yml` заданы параметры для автоматической настройки баз данных и инициализации.

## Примечания

- В качестве мастер-пользователя используется логин `admin` и пароль `secret`.
- Все пароли хранятся в базе данных в хэшированном виде для безопасности.
- Индексирование установлено по полю `item_id` для MongoDB, что ускоряет запросы на получение заказов по `item_id`.

Теперь вы можете использовать приложение для управления пользователями, товарами и заказами, а также для хранения данных в двух разных базах данных: PostgreSQL и MongoDB.
